<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Chatbot Conversationnel</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f2f2f2;
        display: flex;
        justify-content: center;
        padding: 20px;
      }
      #chat-container {
        width: 600px;
        background: #fff;
        border: 1px solid #ccc;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      #messages {
        border: 1px solid #ddd;
        height: 350px;
        overflow-y: auto;
        padding: 10px;
        margin-bottom: 15px;
      }
      .message {
        margin-bottom: 10px;
        padding: 8px;
        border-radius: 4px;
      }
      .user {
        background-color: #d0e7ff;
        text-align: right;
      }
      .bot {
        background-color: #d4f4dd;
        text-align: left;
      }
      #controls {
        display: flex;
        gap: 10px;
      }
      input[type="text"] {
        flex: 1;
        padding: 10px;
        font-size: 16px;
      }
      button {
        padding: 10px 15px;
        font-size: 16px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div id="chat-container">
      <h2>Chatbot Conversationnel</h2>
      <div id="messages"></div>
      <div id="controls">
        <input
          type="text"
          id="userInput"
          placeholder="Ã‰crivez votre message ici..."
        />
        <button id="sendButton">Envoyer</button>
        <button id="voiceButton">ðŸŽ¤ Parler</button>
      </div>
    </div>

    <script>
      const messagesDiv = document.getElementById("messages");
      const userInput = document.getElementById("userInput");
      const sendButton = document.getElementById("sendButton");
      const voiceButton = document.getElementById("voiceButton");

      // Fonction pour ajouter un message Ã  la conversation
      function addMessage(text, sender) {
        const messageElem = document.createElement("div");
        messageElem.classList.add("message", sender);
        messageElem.textContent = text;
        messagesDiv.appendChild(messageElem);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }

      // Fonction pour appeler l'API chatbot (ici par exemple pour la mÃ©tÃ©o ou un chatbot gÃ©nÃ©ral)
      async function callChatbotAPI(promptText) {
        try {
          // Change "city" to "message" in the URL for general conversation
          const response = await fetch(
            `/chatbot?message=${encodeURIComponent(promptText)}&lang=fr`
          );
          const data = await response.json();
          return data.response;
        } catch (error) {
          console.error("Erreur lors de l'appel API :", error);
          return "DÃ©solÃ©, une erreur s'est produite lors de l'appel Ã  l'API.";
        }
      }

      // Gestion de l'envoi par saisie texte
      sendButton.addEventListener("click", async () => {
        const text = userInput.value.trim();
        if (text === "") return;
        addMessage(text, "user");
        userInput.value = "";
        const botResponse = await callChatbotAPI(text);
        addMessage(botResponse, "bot");
      });

      // Gestion de la reconnaissance vocale via l'API Web Speech
      voiceButton.addEventListener("click", () => {
        if (
          !("webkitSpeechRecognition" in window) &&
          !("SpeechRecognition" in window)
        ) {
          alert("Votre navigateur ne supporte pas la reconnaissance vocale.");
          return;
        }
        const SpeechRecognition =
          window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.lang = "fr-FR";
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        recognition.start();

        recognition.onresult = async (event) => {
          const voiceText = event.results[0][0].transcript;
          addMessage(voiceText, "user");
          const botResponse = await callChatbotAPI(voiceText);
          addMessage(botResponse, "bot");
        };

        recognition.onerror = (event) => {
          console.error("Erreur de reconnaissance vocale:", event.error);
        };
      });
    </script>
  </body>
</html>
