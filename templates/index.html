<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Quiz Chatbot</title>
</head>
<body>
  <h1>Quiz Chatbot</h1>
  <label for="category">Choisissez une catégorie :</label>
  <select id="category">
    <option value="maths">Maths</option>
    <option value="science">Science</option>
    <option value="biologie">Biologie</option>
    <option value="agroalimentaire">Agroalimentaire</option>
    <option value="informatique">Informatique</option>
  </select>
  <button id="getQuiz">Obtenir une question</button>

  <div id="quizContainer" style="display: none; margin-top: 20px;">
    <p id="questionText"></p>
    <form id="answerForm">
      <div id="options"></div>
      <button type="submit">Valider la réponse</button>
    </form>
  </div>

  <div id="result" style="margin-top: 20px;"></div>
  <button id="nextQuiz" style="display: none; margin-top: 20px;">Question suivante</button>

  <script>
    // Fonction pour récupérer et afficher une nouvelle question
    function getQuiz() {
      const category = document.getElementById("category").value;
      fetch("/quiz?category=" + category)
      .then(response => response.json())
      .then(data => {
        window.currentQuestion = data;
        document.getElementById("questionText").innerText = data.question;

        // Construction des boutons radio pour les options
        let optionsHTML = "";
        data.options.forEach(option => {
          optionsHTML += `<input type="radio" name="answer" value="${option}" required> ${option}<br>`;
        });
        document.getElementById("options").innerHTML = optionsHTML;

        // Affichage du conteneur de quiz et réinitialisation du résultat
        document.getElementById("quizContainer").style.display = "block";
        document.getElementById("result").innerText = "";

        // Masquer le bouton "Question suivante" lors du chargement d'une nouvelle question
        document.getElementById("nextQuiz").style.display = "none";
      })
      .catch(error => {
        document.getElementById("result").innerText = "Erreur lors de la récupération de la question : " + error;
      });
    }

    // Écouteurs d'événements pour les boutons "Obtenir une question" et "Question suivante"
    document.getElementById("getQuiz").addEventListener("click", getQuiz);
    document.getElementById("nextQuiz").addEventListener("click", getQuiz);

    // Gestion de la soumission de la réponse
    document.getElementById("answerForm").addEventListener("submit", function(e) {
      e.preventDefault();

      // Récupération de la réponse sélectionnée
      const answer = document.querySelector('input[name="answer"]:checked').value;
      const payload = {
        question: window.currentQuestion.question,
        answer: answer,
        correct: window.currentQuestion.correct
      };

      // Envoi de la réponse au endpoint /answer via POST
      fetch("/answer", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload)
      })
      .then(response => response.json())
      .then(result => {
        document.getElementById("result").innerText =
          "Résultat : " + result.result + ". La bonne réponse est : " + result.correct_answer;
        // Affichage du bouton "Question suivante" après réponse
        document.getElementById("nextQuiz").style.display = "block";
      })
      .catch(error => {
        document.getElementById("result").innerText = "Erreur lors de l'envoi de la réponse : " + error;
      });
    });
  </script>
</body>
</html>
